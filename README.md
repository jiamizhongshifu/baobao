# 宝宝故事 (BaoBao Story)

一款专为儿童设计的智能故事讲述应用，让每个宝宝都能成为故事的主角。

## 产品概述

"宝宝故事"是一款专为家长和宝宝设计的iOS应用，它能根据选择的题材自动生成个性化童话故事，并通过AI语音进行生动的讲述。应用特别之处在于可以将宝宝设定为故事的主人公，让故事更有吸引力和教育意义。

## 核心功能

### 1. AI故事生成
- 提供多种故事题材供用户选择（如冒险、童话、动物世界等）
- 基于DeepSeek-v2 API实时生成原创、有教育意义的儿童故事
- 故事内容根据宝宝年龄自动调整难度和长度
- 支持多种故事题材：冒险类、教育类、睡前故事类、节日与季节类

### 2. 个性化定制
- 允许用户创建宝宝档案（姓名、年龄、性别、兴趣爱好等）
- 将宝宝设为故事主角，融入宝宝的特点和兴趣
- 支持保存宝宝喜欢的故事，方便重复收听
- 支持管理多个宝宝档案，为每个宝宝创建个性化故事

### 3. AI语音讲述
- 默认使用Azure的`zh-CN-XiaoxiaoNeural`语音服务
- 提供多种预设人声（如温柔女声、活泼童声等）
- 支持用户上传录音样本（1分钟），训练定制化语音
- 智能配音技术，使故事讲述更加生动有趣
- 支持语速调整和背景音乐选择

### 4. 故事管理与互动
- 故事库功能，保存已生成的故事
- 收藏与分类系统，便于整理喜爱的故事
- 分享功能，支持分享故事文本或音频
- 互动反馈系统，帮助算法学习宝宝偏好

## 设计语言

我们的应用采用专为儿童和家长设计的iOS风格设计语言，确保界面友好、易用且吸引人。详细设计指南见 [.cursor/rules/design_system.json](.cursor/rules/design_system.json)。

### 设计原则
- **简单易懂**：简洁的UI设计，让儿童和家长都能轻松使用
- **视觉吸引**：明亮活泼的色彩系统，吸引儿童注意力
- **一致性**：整个应用保持一致的视觉和交互体验
- **可访问性**：支持VoiceOver、动态文本大小和各种辅助功能

### 颜色系统
- **主色调**：柔和的蓝色系（#A1C4FD, #667EEA）
- **中性色**：干净的白色和渐变灰色
- **语义色**：清晰的功能性颜色指示（成功、警告、错误、信息）

### 组件库
- **iOS风格**：遵循Apple设计指南的组件
- **卡片组件**：故事和内容以圆角卡片形式呈现
- **按钮**：明确的动作按钮，适合儿童触控
- **输入控件**：简化的表单元素，减少输入复杂度

### 动画与过渡
- **流畅过渡**：界面间平滑转换
- **微互动**：为关键操作提供反馈的小动画
- **加载状态**：友好的加载指示器

## 技术架构

### 前端 (iOS)
- 使用Swift和SwiftUI框架开发
- 遵循Apple的Human Interface Guidelines设计直观友好的用户界面
- 采用MVVM架构模式组织代码
- 使用Combine框架处理数据流
- 模块化设计便于维护与扩展

### 后端服务

#### 故事生成服务
- 强制使用DeepSeek-v2 API
- 输入prompt必须包含安全指令：`[严禁暴力][适合5岁以下儿童][主角名称：${childName}]`
- 实现指数退避重试机制处理API限流

```javascript
// DeepSeek故事生成接口
POST https://api.deepseek.com/v1/story/generate

// Headers
{
  "Authorization": "Bearer DEEPSEEK_KEY",
  "X-Safety-Level": "strict" 
}

// 请求体（示例）
{
  "prompt": "生成以{豆豆}为主角的童话，题材：太空冒险，年龄：5岁，爱好：恐龙",
  "max_tokens": 800,
  "temperature": 0.7
}

// 错误处理
429状态码时必须采用指数退避重试
```

#### 语音合成服务
- 默认语音使用Azure的`zh-CN-XiaoxiaoNeural`
- 自定义语音必须通过内容安全审核
- 支持语音速率、音调和音量调整

### 数据存储
- 使用CoreData存储宝宝信息和故事库
- 支持离线访问已生成故事
- 使用CloudKit或Firebase进行云端同步

### 数据流
1. 用户输入（故事题材选择、宝宝信息）
2. 应用构建安全prompt并发送至DeepSeek API
3. DeepSeek生成个性化故事内容
4. 应用将故事文本发送至Azure语音服务
5. 播放合成的语音并显示故事文本

## 代码规范

本项目遵循严格的代码规范和最佳实践，确保代码质量、可维护性和性能。详细规范见 [.cursor/rules/code_standards.json](.cursor/rules/code_standards.json)。

### Swift代码规范
- **命名约定**：使用清晰的驼峰命名法
- **注释风格**：使用三斜线文档注释（///）
- **代码结构**：使用MARK注释分隔代码段
- **错误处理**：明确的错误类型定义和处理
- **内存管理**：防止内存泄漏和循环引用
- **并发处理**：使用Swift并发系统（async/await）

### WebView规范
- **桥接安全**：JS与原生代码安全通信
- **性能监控**：资源加载和性能指标追踪
- **错误处理**：全面捕获和处理JavaScript错误
- **进程管理**：处理WebView进程终止情况

### CSS与HTML规范
- **BEM命名**：遵循BEM方法论命名CSS类
- **响应式**：移动优先的响应式设计
- **语义化**：使用语义化HTML标签
- **组件化**：按功能模块组织CSS

### 可访问性标准
本项目严格遵循可访问性标准，详见 [.cursor/rules/accessibility_guidelines.json](.cursor/rules/accessibility_guidelines.json)。
- **视觉可访问性**：高对比度和可调整文本大小
- **屏幕阅读器支持**：完整的VoiceOver支持
- **触控目标**：充分大的触控区域（最小44×44点）
- **儿童友好**：简化导航和直观操作

## 安全与隐私
- 所有宝宝信息严格保密，仅用于故事生成
- 多层内容过滤确保故事内容适合儿童
- 符合儿童应用相关法规和标准
- 提供家长控制功能，确保内容适合年龄

## 开发路线图

### 第一阶段：基础架构（2周）
- 项目初始化与配置
- 核心数据模型设计
- 基础UI框架

### 第二阶段：用户与宝宝信息模块（2周）
- 用户登录与注册
- 宝宝档案管理

### 第三阶段：故事生成核心功能（3周）
- DeepSeek API集成
- 故事题材选择界面
- 故事生成与预览

### 第四阶段：语音合成功能（3周）
- Azure语音集成
- 自定义语音训练
- 语音播放系统

### 第五阶段：优化与测试（2周）
- 性能优化
- 用户测试
- 上架准备

## 后续迭代展望
- 内容扩展（更多题材、节日特辑）
- 高级个性化（AI生成插图）
- 多平台支持
- 社交功能（家庭共享） 