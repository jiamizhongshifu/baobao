<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>宝宝管理 - 宝宝故事</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/common.css">
    <style>
        body {
            background-color: #F2E9DE;
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            padding: 20px;
        }
        
        .header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .back-button {
            width: 40px;
            height: 40px;
            border-radius: 20px;
            background-color: #FFF;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: #333;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border: none;
            font-size: 18px;
        }
        
        .page-title {
            font-size: 24px;
            font-weight: 700;
            color: #333;
        }
        
        .baby-cards {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .baby-card {
            background-color: #FFF;
            border-radius: 25px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            animation: fadeIn 0.5s;
            position: relative;
        }
        
        .baby-info {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .baby-avatar-container {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin-bottom: 20px;
            overflow: hidden;
            position: relative;
            background-color: #F2E9DE;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        .baby-avatar {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .default-avatar {
            font-size: 40px;
            color: #FFD966;
        }
        
        .avatar-upload-container {
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .avatar-preview {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            overflow: hidden;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #F2E9DE;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        .avatar-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .avatar-upload-button {
            background-color: #F2E9DE;
            color: #333;
            border: none;
            padding: 8px 15px;
            border-radius: 15px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .avatar-upload-button i {
            font-size: 16px;
            color: #FFD966;
        }
        
        .file-input {
            display: none;
        }
        
        .baby-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .baby-name {
            font-size: 28px;
            font-weight: 800;
            color: #333;
        }
        
        .baby-age {
            font-size: 20px;
            color: #666;
        }
        
        .baby-gender {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .baby-gender.boy {
            background-color: #E3F2FD;
            color: #1976D2;
        }
        
        .baby-gender.girl {
            background-color: #FCE4EC;
            color: #D81B60;
        }
        
        .interests-container {
            margin-top: 15px;
        }
        
        .interests-title {
            font-size: 16px;
            color: #666;
            margin-bottom: 10px;
        }
        
        .interests-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .interest-tag {
            background-color: #F2E9DE;
            padding: 8px 15px;
            border-radius: 15px;
            font-size: 14px;
            color: #333;
            font-weight: 600;
        }
        
        .add-baby-button {
            background-color: #FFF;
            border-radius: 25px;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333;
            font-size: 18px;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 2px dashed #FFD966;
            margin-top: auto;
            transition: all 0.3s;
        }
        
        .add-baby-button:active {
            transform: scale(0.98);
        }
        
        .add-baby-button i {
            margin-right: 10px;
            color: #FFD966;
            font-size: 24px;
        }
        
        /* 弹窗样式 */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 1000;
        }
        
        .modal.open {
            display: flex;
            animation: fadeIn 0.3s;
        }
        
        .modal-content {
            background-color: #FFF;
            border-radius: 25px;
            width: 90%;
            max-width: 400px;
            margin: auto;
            padding: 25px;
            position: relative;
            animation: slideUp 0.3s;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: 700;
            color: #333;
        }
        
        .close-modal {
            width: 40px;
            height: 40px;
            border-radius: 20px;
            background-color: #F2E9DE;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            font-size: 20px;
            color: #333;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }
        
        .form-input {
            width: 100%;
            padding: 12px;
            border-radius: 15px;
            border: 2px solid #F2E9DE;
            font-size: 16px;
            color: #333;
            transition: border-color 0.3s;
        }
        
        .form-input:focus {
            border-color: #FFD966;
            outline: none;
        }
        
        .gender-options {
            display: flex;
            gap: 15px;
        }
        
        .gender-option {
            flex: 1;
            padding: 12px;
            border-radius: 15px;
            border: 2px solid #F2E9DE;
            text-align: center;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .gender-option.selected {
            background-color: #FFD966;
            border-color: #FFD966;
            color: #333;
        }
        
        .interests-input-container {
            position: relative;
        }
        
        .interests-input {
            width: 100%;
            padding: 12px;
            border-radius: 15px;
            border: 2px solid #F2E9DE;
            font-size: 16px;
            color: #333;
            margin-bottom: 10px;
        }
        
        .interests-input:focus {
            border-color: #FFD966;
            outline: none;
        }
        
        .interests-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .interest-item {
            background-color: #F2E9DE;
            padding: 8px 15px;
            border-radius: 15px;
            font-size: 14px;
            color: #333;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .remove-interest {
            width: 20px;
            height: 20px;
            border-radius: 10px;
            background-color: #FFF;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            font-size: 12px;
            color: #666;
        }
        
        .submit-button {
            width: 100%;
            padding: 15px;
            border-radius: 20px;
            background-color: #000;
            color: #FFF;
            font-size: 18px;
            font-weight: 600;
            border: none;
            margin-top: 20px;
        }
        
        .submit-button:active {
            transform: scale(0.98);
        }
        
        .baby-actions {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }
        
        .action-button {
            width: 36px;
            height: 36px;
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            font-size: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.2s;
        }
        
        .action-button:active {
            transform: scale(0.95);
        }
        
        .edit-button {
            background-color: #E3F2FD;
            color: #1976D2;
        }
        
        .delete-button {
            background-color: #FFEBEE;
            color: #D32F2F;
        }
        
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 50px 20px;
            background-color: #FFF;
            border-radius: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            text-align: center;
        }
        
        .empty-icon {
            font-size: 60px;
            color: #FFD966;
            margin-bottom: 20px;
        }
        
        .empty-title {
            font-size: 22px;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }
        
        .empty-text {
            font-size: 16px;
            color: #666;
            margin-bottom: 25px;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        /* 确认对话框样式 */
        .confirm-dialog {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 1001;
            animation: fadeIn 0.3s;
        }
        
        .confirm-dialog.open {
            display: flex;
        }
        
        .confirm-content {
            background-color: #FFF;
            border-radius: 20px;
            width: 90%;
            max-width: 320px;
            margin: auto;
            padding: 25px;
            animation: slideUp 0.3s;
        }
        
        .confirm-title {
            font-size: 20px;
            font-weight: 700;
            color: #333;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .confirm-message {
            font-size: 16px;
            color: #666;
            margin-bottom: 25px;
            text-align: center;
        }
        
        .confirm-buttons {
            display: flex;
            gap: 15px;
        }
        
        .confirm-button {
            flex: 1;
            padding: 12px;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            border: none;
        }
        
        .confirm-cancel {
            background-color: #F5F5F5;
            color: #333;
        }
        
        .confirm-ok {
            background-color: #FF5252;
            color: #FFF;
        }
    </style>
</head>
<body>
    <div class="header">
        <button class="back-button" onclick="history.back()">
            <i class="fas fa-arrow-left"></i>
        </button>
        <h1 class="page-title">宝宝档案</h1>
    </div>
    
    <div class="baby-cards" id="babyCards">
        <!-- 宝宝卡片会通过JavaScript动态生成 -->
    </div>
    
    <!-- 添加宝宝按钮 -->
    <button class="add-baby-button" onclick="openModal()">
        <i class="fas fa-plus"></i>
        添加宝宝
    </button>

    <!-- 添加/编辑宝宝弹窗 -->
    <div class="modal" id="babyModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">添加宝宝</h2>
                <button class="close-modal" onclick="closeModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="babyForm" onsubmit="return false;">
                <input type="hidden" id="babyId" value="">
                
                <div class="avatar-upload-container">
                    <div class="avatar-preview" id="avatarPreview">
                        <i class="fas fa-baby default-avatar" id="defaultAvatar"></i>
                        <img id="avatarImage" style="display: none;" src="" alt="宝宝头像">
                    </div>
                    <label class="avatar-upload-button">
                        <i class="fas fa-camera"></i>
                        上传头像
                        <input type="file" class="file-input" id="avatarUpload" accept="image/*" onchange="previewAvatar(this)">
                    </label>
                </div>
                
                <div class="form-group">
                    <label class="form-label">宝宝昵称</label>
                    <input type="text" class="form-input" id="babyName" placeholder="请输入宝宝的昵称">
                </div>
                
                <div class="form-group">
                    <label class="form-label">年龄</label>
                    <input type="text" class="form-input" id="babyAge" placeholder="例如：2岁3个月">
                </div>

                <div class="form-group">
                    <label class="form-label">性别</label>
                    <div class="gender-options">
                        <div class="gender-option" onclick="selectGender('boy')" id="boyOption">男宝宝</div>
                        <div class="gender-option" onclick="selectGender('girl')" id="girlOption">女宝宝</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">兴趣标签</label>
                    <div class="interests-input-container">
                        <input type="text" class="interests-input" id="interestInput" 
                               placeholder="输入兴趣标签，按回车添加" 
                               onkeypress="addInterestOnEnter(event)">
                        <div class="interests-list" id="interestsList"></div>
                    </div>
                </div>
                
                <button class="submit-button" onclick="submitForm()">保存</button>
            </form>
        </div>
    </div>
    
    <!-- 确认删除对话框 -->
    <div class="confirm-dialog" id="confirmDialog">
        <div class="confirm-content">
            <div class="confirm-title">确认删除</div>
            <div class="confirm-message">确定要删除这个宝宝信息吗？此操作无法撤销。</div>
            <div class="confirm-buttons">
                <button class="confirm-button confirm-cancel" onclick="cancelDelete()">取消</button>
                <button class="confirm-button confirm-ok" onclick="confirmDelete()">删除</button>
            </div>
        </div>
    </div>
    
    <!-- 空状态提示 -->
    <div class="empty-state" id="emptyState" style="display: none;">
        <div class="empty-icon">
            <i class="fas fa-baby"></i>
        </div>
        <div class="empty-title">还没有宝宝信息</div>
        <div class="empty-text">添加宝宝信息，开始记录宝宝的故事之旅吧！</div>
        <button class="add-baby-button" style="width: auto; padding: 15px 30px;" onclick="openModal()">
            <i class="fas fa-plus"></i>
            添加宝宝
        </button>
    </div>
    
    <script src="../js/common.js"></script>
    <script>
        // 全局变量
        let babies = [];
        let selectedGender = '';
        let interests = [];
        let editingBabyId = null;
        let deletingBabyId = null;
        let currentAvatar = null; // 存储当前选择的头像
        
        // 初始化页面
        document.addEventListener('DOMContentLoaded', function() {
            loadBabies();
            renderBabies();
        });
        
        // 从localStorage加载宝宝数据
        function loadBabies() {
            const savedBabies = localStorage.getItem('babies');
            if (savedBabies) {
                babies = JSON.parse(savedBabies);
            }
        }
        
        // 保存宝宝数据到localStorage
        function saveBabies() {
            localStorage.setItem('babies', JSON.stringify(babies));
        }
        
        // 渲染宝宝卡片
        function renderBabies() {
            const babyCards = document.getElementById('babyCards');
            const emptyState = document.getElementById('emptyState');
            
            // 清空现有卡片
            babyCards.innerHTML = '';
            
            // 检查是否有宝宝数据
            if (babies.length === 0) {
                babyCards.style.display = 'none';
                emptyState.style.display = 'flex';
                return;
            }
            
            // 显示宝宝卡片
            babyCards.style.display = 'flex';
            emptyState.style.display = 'none';
            
            // 为每个宝宝创建卡片
            babies.forEach(baby => {
                const card = document.createElement('div');
                card.className = 'baby-card';
                card.dataset.id = baby.id;
                
                const avatarHtml = baby.avatar 
                    ? `<img src="${baby.avatar}" alt="${baby.name}" class="baby-avatar">` 
                    : `<i class="fas fa-baby default-avatar"></i>`;
                
                card.innerHTML = `
                    <div class="baby-actions">
                        <button class="action-button edit-button" onclick="editBaby('${baby.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-button delete-button" onclick="deleteBaby('${baby.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    <div class="baby-info">
                        <div class="baby-avatar-container">
                            ${avatarHtml}
                        </div>
                        <div class="baby-header">
                            <div class="baby-name">${baby.name}</div>
                            <div class="baby-age">${baby.age}</div>
                        </div>
                        <div class="baby-gender ${baby.gender}">${baby.gender === 'boy' ? '男宝宝' : '女宝宝'}</div>
                        <div class="interests-container">
                            <div class="interests-title">兴趣标签</div>
                            <div class="interests-tags">
                                ${baby.interests.map(interest => `
                                    <span class="interest-tag">${interest}</span>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
                
                babyCards.appendChild(card);
            });
        }
        
        // 打开添加/编辑宝宝弹窗
        function openModal(isEdit = false) {
            document.getElementById('modalTitle').textContent = isEdit ? '编辑宝宝' : '添加宝宝';
            document.getElementById('babyModal').classList.add('open');
        }
        
        // 关闭弹窗
        function closeModal() {
            document.getElementById('babyModal').classList.remove('open');
            resetForm();
        }
        
        // 选择性别
        function selectGender(gender) {
            selectedGender = gender;
            document.getElementById('boyOption').classList.remove('selected');
            document.getElementById('girlOption').classList.remove('selected');
            document.getElementById(`${gender}Option`).classList.add('selected');
        }
        
        // 按回车添加兴趣标签
        function addInterestOnEnter(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                const input = document.getElementById('interestInput');
                const interest = input.value.trim();
                
                if (interest && !interests.includes(interest)) {
                    interests.push(interest);
                    updateInterestsList();
                }
                
                input.value = '';
            }
        }
        
        // 移除兴趣标签
        function removeInterest(index) {
            interests.splice(index, 1);
            updateInterestsList();
        }
        
        // 更新兴趣标签列表
        function updateInterestsList() {
            const list = document.getElementById('interestsList');
            list.innerHTML = interests.map((interest, index) => `
                <div class="interest-item">
                    ${interest}
                    <button class="remove-interest" onclick="removeInterest(${index})">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `).join('');
        }
        
        // 显示头像预览
        function previewAvatar(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const defaultAvatar = document.getElementById('defaultAvatar');
                    const avatarImage = document.getElementById('avatarImage');
                    
                    avatarImage.src = e.target.result;
                    avatarImage.style.display = 'block';
                    defaultAvatar.style.display = 'none';
                    
                    currentAvatar = e.target.result;
                }
                
                reader.readAsDataURL(input.files[0]);
            }
        }
        
        // 重置头像预览
        function resetAvatarPreview() {
            const defaultAvatar = document.getElementById('defaultAvatar');
            const avatarImage = document.getElementById('avatarImage');
            
            avatarImage.src = '';
            avatarImage.style.display = 'none';
            defaultAvatar.style.display = 'block';
            
            currentAvatar = null;
        }
        
        // 编辑宝宝信息
        function editBaby(id) {
            // 找到要编辑的宝宝
            const baby = babies.find(b => b.id === id);
            if (!baby) return;
            
            // 设置编辑状态
            editingBabyId = id;
            
            // 填充表单
            document.getElementById('babyId').value = baby.id;
            document.getElementById('babyName').value = baby.name;
            document.getElementById('babyAge').value = baby.age;
            
            // 设置头像
            if (baby.avatar) {
                const defaultAvatar = document.getElementById('defaultAvatar');
                const avatarImage = document.getElementById('avatarImage');
                
                avatarImage.src = baby.avatar;
                avatarImage.style.display = 'block';
                defaultAvatar.style.display = 'none';
                
                currentAvatar = baby.avatar;
            } else {
                resetAvatarPreview();
            }
            
            // 设置性别
            selectedGender = baby.gender;
            document.getElementById('boyOption').classList.remove('selected');
            document.getElementById('girlOption').classList.remove('selected');
            document.getElementById(`${baby.gender}Option`).classList.add('selected');
            
            // 设置兴趣标签
            interests = [...baby.interests];
            updateInterestsList();
            
            // 打开弹窗
            openModal(true);
        }
        
        // 删除宝宝信息
        function deleteBaby(id) {
            deletingBabyId = id;
            document.getElementById('confirmDialog').classList.add('open');
        }
        
        // 取消删除
        function cancelDelete() {
            deletingBabyId = null;
            document.getElementById('confirmDialog').classList.remove('open');
        }
        
        // 确认删除
        function confirmDelete() {
            if (deletingBabyId) {
                // 从数组中删除
                babies = babies.filter(baby => baby.id !== deletingBabyId);
                
                // 保存更新后的数据
                saveBabies();
                
                // 重新渲染页面
                renderBabies();
                
                // 显示提示
                showToast('宝宝信息已删除');
                
                // 关闭确认对话框
                document.getElementById('confirmDialog').classList.remove('open');
                deletingBabyId = null;
            }
        }
        
        // 提交表单
        function submitForm() {
            const name = document.getElementById('babyName').value;
            const age = document.getElementById('babyAge').value;
            
            if (!name || !age || !selectedGender) {
                showToast('请填写完整信息');
                return;
            }
            
            // 准备宝宝数据
            const babyData = {
                id: editingBabyId || generateId(),
                name,
                age,
                gender: selectedGender,
                interests: [...interests],
                avatar: currentAvatar
            };
            
            // 如果是编辑模式
            if (editingBabyId) {
                // 更新现有宝宝数据
                const index = babies.findIndex(baby => baby.id === editingBabyId);
                if (index !== -1) {
                    babies[index] = babyData;
                }
                showToast('宝宝信息已更新');
            } else {
                // 添加新宝宝
                babies.push(babyData);
                showToast('宝宝添加成功');
            }
            
            // 保存数据
            saveBabies();
            
            // 重新渲染页面
            renderBabies();
            
            // 关闭弹窗
            closeModal();
            
            // 重置编辑状态
            editingBabyId = null;
        }
        
        // 重置表单
        function resetForm() {
            document.getElementById('babyId').value = '';
            document.getElementById('babyName').value = '';
            document.getElementById('babyAge').value = '';
            selectedGender = '';
            document.getElementById('boyOption').classList.remove('selected');
            document.getElementById('girlOption').classList.remove('selected');
            interests = [];
            updateInterestsList();
            resetAvatarPreview();
            document.getElementById('avatarUpload').value = '';
            editingBabyId = null;
        }
        
        // 生成唯一ID
        function generateId() {
            return 'baby_' + Date.now() + '_' + Math.floor(Math.random() * 1000);
        }
    </script>
</body>
</html> 